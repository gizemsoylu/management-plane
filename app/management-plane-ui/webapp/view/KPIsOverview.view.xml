<mvc:View
    controllerName="com.ndbs.managementplaneui.controller.KPIsOverview"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:core="sap.ui.core"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    height="100%"
>
    <Page
        id="page"
        title="{i18n>title}"
        showNavButton="true"
        navButtonPress="onNavToHomepage"
    >
        <HBox>
            <VBox>
                <FlexBox
                    justifyContent="Start"
                    wrap="Wrap"
                >
                    <f:Card
                        class="sapUiSmallMargin"
                        width="300px"
                    >
                        <f:header>
                            <card:Header
                               id="cardHKPIsOverview"
                            />
                        </f:header>
                        <f:content>
                            <List id="fbKPIsOverview" 
                            items="{path:'/VKPIs', suspended:true}" updateFinished="onKPIUpdateFinished">
                                <CustomListItem class="sapUiSmallMarginBottom">
                                    <HBox alignItems="Center">
                                        <VBox class="sapUiSmallMargin">
                                            <Text
                                                text="{KPIChapterID} - {KPIChapterName}"
                                            />
                                        </VBox>
                                    </HBox>
                                </CustomListItem>
                            </List>
                        </f:content>
                    </f:Card>
                </FlexBox>
                <FlexBox>
                    <f:Card
                        class="sapUiSmallMargin"
                        width="300px"
                    >
                        <f:header>
                            <card:Header
                                title="KPIs Distribution"
                                subtitle="Overview"
                            />
                        </f:header>
                        <f:content>
                            <viz:VizFrame
                                id="idVizFrame"
                                uiConfig="{applicationSet:'fiori'}"
                                vizType="pie"
                                height="300px"
                                width="380px"
                            >
                                <viz:dataset>
                                    <viz.data:FlattenedDataset
                                        data="{
                                        path: '/VKPIStateCount'
                                       
                                        }"
                                    >
                                        <viz.data:dimensions>
                                            <viz.data:DimensionDefinition
                                                name="State"
                                                value="{KPIState}"
                                            />
                                        </viz.data:dimensions>
                                        <viz.data:measures>
                                            <viz.data:MeasureDefinition
                                                name="Count"
                                                value="{KPIStateCount}"
                                            />
                                        </viz.data:measures>
                                    </viz.data:FlattenedDataset>
                                </viz:dataset>
                                <viz:feeds>
                                    <viz.feeds:FeedItem
                                        uid="size"
                                        type="Measure"
                                        values="Count"
                                    />
                                    <viz.feeds:FeedItem
                                        uid="color"
                                        type="Dimension"
                                        values="State"
                                    />
                                </viz:feeds>
                            </viz:VizFrame>
                        </f:content>
                    </f:Card>
                </FlexBox>
            </VBox>
            <HBox>
                <FlexBox
                    justifyContent="SpaceBetween"
                    wrap="Wrap"
                >
                    <f:Card
                        class="sapUiSmallMargin"
                        width="auto"
                        height="auto"
                    >
                        <f:header>
                            <card:Header
                               id="cardHKPIsState"
                            />
                        </f:header>

                        <f:content>
                            
                            <Table id="tableKPIsOverview" class="sapUiSmallMarginBottom" items="{path: '/VKPIs'}" width="100%" growing="true" growingThreshold="20">
                            <columns>
                                <Column>
                                      <Text text="KPI Name" />
                                </Column>
                                <Column>
                                        <Text text="Date of Processing" />
                                </Column>
                                 <Column>
                                        <Text text="State" />
                                </Column>
                                 <Column>
                                        <Text text="Lorem Ipsum" />
                                </Column>
                            </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{KPIChapterID} - {KPIChapterName}" />
                                            <Text text="{KPIDateofProcessing}" />
                                            <Text text="{KPIState}" />
                                            <Text text="{KPISubDescription}"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                             </Table>
                        </f:content>
                    </f:Card>
                </FlexBox>
                <FlexBox
                    id="fbKPIsDetail"
                    justifyContent="Start"
                    wrap="Wrap"
                    items="{path:'/KPIs'}"
                >
                    <f:Card
                        class="sapUiSmallMargin"
                        width="300px"
                    >
                        <f:header>
                            <card:Header
                                title="{chapterID}-{chapterName}"
                                iconSrc="{sapIcon}"
                                subtitle="{subDescription}"
                                iconBackgroundColor="Random"
                                iconDisplayShape="Circle"
                            />
                        </f:header>
                        <f:content>
                            <VBox
                                height="110px"
                                width="380px"
                                class="sapUiSmallMargin"
                                justifyContent="SpaceAround"
                                fitContainer="false"
                                wrap="Wrap"
                            >
                                <HBox justifyContent="SpaceBetween">
                                    <Text text="{subDescription}" />
                                </HBox>
                                <HBox
                                    renderType="Bare"
                                    justifyContent="End"
                                >
                                    <Button
                                        id="btnCard"
                                        text="Open"
                                        press="onCardPress"
                                        type="Emphasized"
                                        class="sapUiTinyMarginBegin"
                                    >
                                        <customData>
                                            <core:CustomData
                                                key="sectionID"
                                                value="{sectionID}"
                                            />
                                            <core:CustomData
                                                key="kpiID"
                                                value="{ID}"
                                            />
                                        </customData>
                                    </Button>
                                </HBox>
                            </VBox>
                        </f:content>
                    </f:Card>
                </FlexBox>
            </HBox>
        </HBox>
    </Page>
</mvc:View>
