<mvc:View
    controllerName="com.ndbs.managementplaneui.controller.KPIsOverview"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:core="sap.ui.core"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    height="100%"
>
    <Page
        id="page"
        title="{i18n>title}"
        showNavButton="true"
        navButtonPress="onNavToHomepage"
    >
        <FlexBox
            justifyContent="Center"
            alignItems="Center"
        >
            <VBox width="95%">
                <FlexBox
                    id="fbKPIsOverview"
                    justifyContent="Start"
                    wrap="Wrap"
                    items="{path:'/VKPIs', suspended:true}"
                >
                    <HBox>
                        <f:Card
                            class="sapUiSmallMargin"
                            width="300px"
                        >
                            <f:header>
                                <card:Header
                                    title="{SectionType} - {SectionName}"
                                />
                            </f:header>

                            <f:content>
                                <List
                                    class="sapUiSmallMarginBottom"
                                    showSeparators="None"
                                    items="{                       
                                    path: '/VKPIs',
                                    parameters: {
                                        event: {
                                            dataReceived: 'ondataReceived' 
                                        }
                                    }

				                    }"
                                    
                                >
                                    <CustomListItem>
                                        <HBox alignItems="Center">
                                            <VBox class="sapUiSmallMargin">
                                                <Text
                                                    text="{KPIChapterID} - {KPIChapterName}"
                                                />
                                            </VBox>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </f:content>
                        </f:Card>
                    </HBox>
                </FlexBox>
                <f:Card
                    class="sapUiSmallMargin"
                    width="300px"
                >
                    <f:header>
                        <card:Header
                            title="KPIs Distribution"
                            subtitle="Overview"
                        />
                    </f:header>
                    <f:content>
                        <viz:VizFrame
                            id="idVizFrame"
                            uiConfig="{applicationSet:'fiori'}"
                            vizType="pie"
                            height="300px"
                            width="380px"
                        >
                            <viz:dataset>
                                <viz.data:FlattenedDataset
                                    data="{path: '/KPIs'}"
                                >
                                    <viz.data:dimensions>
                                        <viz.data:DimensionDefinition
                                            name="Value"
                                            value="{state}"
                                        />
                                    </viz.data:dimensions>
                                    <viz.data:measures>
                                        <viz.data:MeasureDefinition
                                            name="Chapter"
                                            value="{stateCount}"
                                        />
                                    </viz.data:measures>
                                </viz.data:FlattenedDataset>
                            </viz:dataset>
                            <viz:feeds>
                                <viz.feeds:FeedItem
                                    uid="size"
                                    type="Measure"
                                    values="Chapter"
                                />
                                <viz.feeds:FeedItem
                                    uid="color"
                                    type="Dimension"
                                    values="Value"
                                />
                            </viz:feeds>
                        </viz:VizFrame>
                    </f:content>
                </f:Card>

                <VBox />
                <FlexBox
                    id="fbKPIsDetail"
                    justifyContent="Start"
                    wrap="Wrap"
                    items="{path:'/KPIs'}"
                >
                    <HBox>
                        <f:Card
                            class="sapUiSmallMargin"
                            width="300px"
                        >
                            <f:header>
                                <card:Header
                                    title="{chapterID}-{chapterName}"
                                    iconSrc="{sapIcon}"
                                    subtitle="{subDescription}"
                                    iconBackgroundColor="Random"
                                    iconDisplayShape="Circle"
                                />
                            </f:header>
                            <f:content>
                                <VBox
                                    height="110px"
                                    width="380px"
                                    class="sapUiSmallMargin"
                                    justifyContent="SpaceAround"
                                    fitContainer="false"
                                    wrap="Wrap"
                                >
                                    <HBox justifyContent="SpaceBetween">
                                        <Text text="{subDescription}" />
                                    </HBox>
                                    <HBox
                                        renderType="Bare"
                                        justifyContent="End"
                                    >
                                        <Button
                                            id="btnCard"
                                            text="Open"
                                            press="onCardPress"
                                            type="Emphasized"
                                            class="sapUiTinyMarginBegin"
                                        >
                                            <customData>
                                                <core:CustomData
                                                    key="sectionID"
                                                    value="{sectionID}"
                                                />
                                                <core:CustomData
                                                    key="kpiID"
                                                    value="{ID}"
                                                />
                                            </customData>
                                        </Button>
                                    </HBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                    </HBox>
                </FlexBox>
            </VBox>
        </FlexBox>
    </Page>
</mvc:View>
